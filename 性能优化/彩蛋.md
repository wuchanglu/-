# CDN 的缓存与回源机制解析

## 什么是 CDN?

> CDN(Content Delivery Network,即内容分发网络)指的是一组分布在各个地区的服务器。这些服务器存储着数据的副本，因此服务器可以根据哪些服务器与用户距离最近，来满足数据的请求。CDN 提供快速服务，较少受高流量影响。

CDN 正常情况下是就近原则，就近服务器返回资源

## CDN 核心功能：缓存、回源

1. 缓存就是把资源文件 copy 一份到 CDN 服务器上这个过程
2. 回源就是说 CDN 服务器发现自己没有这个资源（一般是缓存的数据过期了），转头向上层服务器或者根服务器去要这个资源的过程。

## CDN 与前端性能优化

CDN 往往被用来存放静态资源，上文提到的根服务器本质上是业务服务器，它的任务在于**生产动态页面或返回纯静态页面**，这都是需要占用计算资源的。CDN 类似仓库，业务服务器像是工厂。  
静态资源，像是 JS、CSS、图片等不需要业务服务器计算即得的资源，动态资源指的是需要后端实时动态生成的资源，较为常见 JSP、ASP 或者依赖服务端渲染计算所得的 HTML  
非纯静态资源，指需要服务器在页面之外做额外计算的 HTML 页面。如打开一个网站，网站需要根据身份进行反对对应的 HTML 文件，这种情况下页面文件确实是静态的，但是它与业务服务器的操作耦合，因此放在 CDN 上显然是不合适的。

## CDN 实际应用

静态资源走 CDN  
CDN 的域名不要与业务服务器的域名相同，因为 cookie 是紧跟域名的，如果放在同一个域下面，我们请求图片等静态资源，本身不需要携带的 cookie 参数携带过去了，造成了多余的带宽占用
