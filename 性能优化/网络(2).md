# 图片优化——质量与性能的博弈

`图片这一块与其说是优化还不如说是在做权衡，因为要做的事情就是去压缩图片的体积，但是这个操作是以牺牲图像质量为代价的。因此我们的主要任务，是尽可能地去寻找一个质量与性能之间的平衡点`

### 时下应用较为广泛的 Web 图片格式有 JPEG/JPG、PNG、WebP、Base64、SVG 等

## 前置知识：二级制位数与色彩的关系

计算机中像素用二进制数来表示，一个像素对应的二进制位数越多，它可以表示的颜色种类就越多，成像效果就更细腻，于此同时体积也会越大  
一个二进制位表示两种颜色(0|1 对应黑|白)，假设一种图片格式对应的二进制位数为 n 那么它就可以呈现 2^n 种颜色。

## 具体图片格式分析

### JPEG/JPG

关键字：**有损压缩、体积小、加载快、不支持透明**

**_优点：_**
JPG 最大的特点是**有损压缩**，是一种高质量的压缩方式，在图片体积被压缩至原本的 50%甚至以下时，JPG 仍然可以保持住 60%的品质。以 24 位存储单个图，可以呈现 1600 万种颜色，足以应付大多数场景下对色彩的要求  
**_缺点：_**  
但当它处理矢量图形和 Logo 等线条感较强、颜色对比强烈的图像时，人为压缩导致的图片模糊会相当明显。此外，JPEG 图像不支持透明度处理，透明图片需要召唤 PNG 来呈现。
**_使用场景：_**  
JPG 适用于呈现色彩丰富的图片，**日常开发中 JPG 经常作为大的背景图、轮播图或者 Banner 图出现**，使用 JPG 呈现大图，既可以保住图片的质量，又不会带来令人头疼的图片体积问题，是当下比较推荐的一种方式。

### PNG-8 与 PNG-24

关键字: **无损压缩、质量高、体积大、支持透明**

**_PNG 的优点：_**
无损压缩的高保真图片格式，8 和 24 进制数的格式对应的是支持 256 种颜色和 1600 万种颜色。PNG 图片具有比 JPG 更强的色彩表现力，对线条处理更加细腻，**对透明度有良好的支持**。弥补了上面提到的 JPG 的局限性，唯一的 BUG 就是**体积太大**  
`PNG-8与PNG-24在能图像质量能接受的范围内尽量选择PNG-24`  
**_应用场景：_**  
考虑到 PNG 在处理线条和颜色对比度方面的优势，我们主要用它来呈现小的 logo、颜色简单对比强烈的图片或背景等

### SVG

关键字：**文本文件、体积小、不失真、兼容性好**  
`SVG（可缩放矢量图形）是一种基于 XML 语法的图像格式。它和本文提及的其它图片种类有着本质的不同：SVG 对图像的处理不是基于像素点，而是是基于对图像的形状描述。`  
**_SVG 的特性_**：  
文件体积更小、可压缩性更强；因为是矢量图所以图片可以无限放大而且不会失真；SVG 是文本文件可编程，在页面里面就是 DOM 的一部分，具有更较强的灵活性  
**_SVG 缺点_**：  
渲染成本高，学习成本高(可编程特性所致)  
**_使用方式和应用场景_**：

```js
在页面种以<svg xmlns='xx'>标签形式引入，或者<img src='xxx'/>图片资源形式引入。
```

实际开发中小 icon 这些可以采用 svg，其他的也可以尽量使用 svg，正常情况下 ui 会给，或者网上的[在线矢量图标库](https://www.iconfont.cn/)

### base64

什么是 base64：Base64 是一种用于传输 8Bit 字节码的编码方式，通过对图片进行 Base64 编码，我们可以直接将编码结果写入 HTML 或者写入 CSS，从而减少 HTTP 请求的次数。

是一种编码方式，一张图片转成 base64 之后体积会膨大 4/3（这是由 Base64 的编码原理决定的）。

**_优点_**： 可以直接放置在 html、js、css 文件里面，减少了 http 请求次数

**适用场景**： 图片尺寸小，无法以雪碧图形式与其它小图结合，图片更新频率非常低

### 雪碧图

通过将多张小图片合并成一张图片，使用的时候作为背景图片引入，然后通过背景的定位显示相应的内容  
优点是减少了 http 请求，对带宽和内存更加友好

### webp

它于 2010 年被提出， 是 Google 专为 Web 开发的一种旨在加快图片加载速度的图片格式，它支持有损压缩和无损压缩。
**_优点_**：  
与 png 相比，无损图像的尺寸压缩小了 26%的体积，同等图片质量下，webp 压缩体积比 jpeg 小了 25-34%。无损 webp 也支持透明度（又称 alpha 通道），只需提供额外 22%的字节。对于有损 RGB 压缩可接受的情况，有损 WebP 也支持透明度，与 PNG 相比，通常提供 3 倍的文件大小。  
**_局限性_**：太年轻，兼容性不好，增加服务器负担（和编码 jpg 相比编码 webp 会占用更多的计算资源）  
**_应用场景_**：无需考虑兼容的情况下，或者采取了降级方案的时候
